"use strict";function RotationPad(a){var t,e,n,i,o=!1,r=this;function d(a,t){e=a-r.regionData.offset.left,n=t-r.regionData.offset.top,Math.pow(r.regionData.centerX-e,2)+Math.pow(r.regionData.centerY-n,2)>Math.pow(r.regionData.radius,2)&&(i=Math.atan2(n-r.regionData.centerY,e-r.regionData.centerX),e=Math.cos(i)*r.regionData.radius+r.regionData.centerX,n=Math.sin(i)*r.regionData.radius+r.regionData.centerY),n=Math.round(10*n)/10,e=Math.round(10*e)/10,r.handle.css({top:n-r.handleData.radius,left:e-r.handleData.radius});var o=r.regionData.centerX-parseInt(e),d=r.regionData.centerY-parseInt(n);o=4*(o- -r.regionData.radius)/(r.regionData.radius- -r.regionData.radius)-2,d=4*(d- -r.regionData.radius)/(r.regionData.radius- -r.regionData.radius)-2,s(o=-1*Math.round(10*o)/10,d=-1*Math.round(10*d)/10)}function s(a,e){if(o){clearTimeout(t),t=setTimeout((function(){s(a,e)}),5);var n=$.Event("YawPitch",{detail:{deltaX:a,deltaY:e},bubbles:!1});$(r).trigger(n)}else clearTimeout(t)}r.container=a,r.regionData={},r.handleData={},r.rotationPad=$('<div class="rotation-pad"></div>'),r.region=$('<div class="region"></div>'),r.handle=$('<div class="handle"></div>'),r.rotationPad.append(r.region).append(r.handle),r.container.append(r.rotationPad),r.rotationPad.css({top:r.container.find("canvas").height()+r.container.position().top-r.region.outerHeight()-10,left:r.container.find("canvas").width()-r.region.outerWidth()-20}),r.regionData.width=r.region.outerWidth(),r.regionData.height=r.region.outerHeight(),r.regionData.position=r.region.position(),r.regionData.offset=r.region.offset(),r.regionData.radius=r.regionData.width/2,r.regionData.centerX=r.regionData.position.left+r.regionData.radius,r.regionData.centerY=r.regionData.position.top+r.regionData.radius,r.handleData.width=r.handle.outerWidth(),r.handleData.height=r.handle.outerHeight(),r.handleData.radius=r.handleData.width/2,r.regionData.radius=r.regionData.width/2-r.handleData.radius,r.region.on("mousedown",(function(a){o=!0,r.handle.css("opacity","1.0"),d(a.pageX,a.pageY)})),$(document).on("mouseup",(function(){o=!1,r.resetHandlePosition()})),$(document).on("mousemove",(function(a){o&&d(a.pageX,a.pageY)})),r.region.on("touchstart",(function(a){o=!0,r.handle.css("opacity","1.0"),d(a.originalEvent.targetTouches[0].pageX,a.originalEvent.targetTouches[0].pageY)})),$(document).on("touchend touchcancel",(function(){o=!1,r.resetHandlePosition()})),$(document).on("touchmove",(function(a){o&&d(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)})),r.resetHandlePosition()}RotationPad.prototype={resetHandlePosition:function(){this.handle.animate({top:this.regionData.centerY-this.handleData.radius,left:this.regionData.centerX-this.handleData.radius,opacity:.1},"fast")}};